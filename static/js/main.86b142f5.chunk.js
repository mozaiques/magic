(this.webpackJsonpmagic=this.webpackJsonpmagic||[]).push([[0],{44:function(e,n,t){e.exports=t(56)},56:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(31),l=t.n(c),i=t(4),o=t(2),u=t(60),s=t(3);function f(){var e=Object(o.a)(["\n  display: block;\n  width: 100%;\n"]);return f=function(){return e},e}function d(){var e=Object(o.a)(["\n  display: block;\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  width: 100%;\n  height: 140px;\n\n  font-family: monospace;\n  word-break: break-all;\n  resize: none;\n"]);return d=function(){return e},e}function b(){var e=Object(o.a)(["\n  display: block;\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  width: 100%;\n"]);return b=function(){return e},e}function m(){var e=Object(o.a)(["\n  display: block;\n  margin-bottom: 2rem;\n"]);return m=function(){return e},e}function p(){var e=Object(o.a)(["\n  margin-bottom: 1rem;\n\n  font-weight: 900;\n  font-size: 2rem;\n"]);return p=function(){return e},e}function v(){var e=Object(o.a)(["\n  padding: 1rem;\n  max-width: 640px;\n"]);return v=function(){return e},e}function h(){var e=Object(o.a)(["\n  display: block;\n  width: 100%;\n  padding: 1rem;\n\n  border: 1px dotted ",";\n\n  font-size: 1rem;\n  background-color: white;\n  cursor: pointer;\n\n  &:hover {\n    background-color: ",";\n  }\n"]);return h=function(){return e},e}var g=s.b.button(h(),"#ccc","#f8f8f8"),O=s.b.div(v()),E=s.b.h2(p()),j=s.b.label(m()),x=s.b.input(b()),y=s.b.textarea(d()),w=s.b.div(f()),C=function(e){var n=e.label,t=e.placeholder,c=e.onSubmit,l=e.submitButtonLabel,o=e.readOnly,u=Object(a.useState)(""),s=Object(i.a)(u,2),f=s[0],d=s[1];return r.a.createElement(w,null,r.a.createElement(j,null,n,r.a.createElement(y,{placeholder:t,onChange:function(e){d(e.target.value)},value:f,readOnly:o})),c?r.a.createElement(g,{onClick:function(){c(JSON.parse(f))}},l||"Submit"):null)},S=function(e){var n=e.label,t=e.content;return r.a.createElement(w,null,r.a.createElement(j,null,n,r.a.createElement(y,{value:t,readOnly:!0})))};function k(){var e=Object(o.a)(["\n  &:not(:last-child) {\n    margin-right: 1rem;\n  }\n"]);return k=function(){return e},e}function L(){var e=Object(o.a)(["\n  display: flex;\n"]);return L=function(){return e},e}var D=s.b.div(L()),A=Object(s.b)(g)(k());function P(e){var n=e.label,t=e.placeholder,a=e.value,c=e.onChange;return r.a.createElement(j,null,n,r.a.createElement(x,{type:"text",value:a,placeholder:t,onChange:function(e){c(e.target.value)}}))}function N(e){var n=e.label,t=e.placeholder,a=e.value,c=e.onChange;return r.a.createElement(j,null,n,r.a.createElement(x,{type:"text",value:a,placeholder:t,onChange:function(e){console.log(e.target.value),c(e.target.value)}}))}var R=function(e){var n=e.addPlayer,t=Object(u.e)(),c=Object(a.useState)(""),l=Object(i.a)(c,2),o=l[0],s=l[1],f=Object(a.useState)(40),d=Object(i.a)(f,2),b=d[0],m=d[1];return r.a.createElement(O,null,r.a.createElement(E,null,"Add player"),r.a.createElement(P,{label:"Player name",placeholder:"Insert the player name",value:o,onChange:function(e){s(e)}}),r.a.createElement(N,{label:"Player initial life points",placeholder:"Insert the player initial life points",value:null===b?"":b.toString(),onChange:function(e){!function(e){var n=parseInt(e);Number.isNaN(n)||n<=0?m(null):m(n)}(e)}}),r.a.createElement(D,null,r.a.createElement(A,{onClick:function(){t.push("/i")}},"Cancel"),r.a.createElement(A,{onClick:function(){""!==o&&null!==b&&(n({uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)})),name:o,initialLifePoints:b}),t.push("/i"))}},"Add player")))};function J(){var e=Object(o.a)(["\n  padding: 0.25rem;\n  border-radius: 4px;\n  border: 1px solid ",";\n"]);return J=function(){return e},e}function z(){var e=Object(o.a)([""]);return z=function(){return e},e}function I(){var e=Object(o.a)(["\n  flex: 1;\n"]);return I=function(){return e},e}function T(){var e=Object(o.a)(["\n  display: flex;\n  padding: 1rem;\n"]);return T=function(){return e},e}function B(){var e=Object(o.a)(["\n  font-style: italic;\n  text-align: center;\n"]);return B=function(){return e},e}function M(){var e=Object(o.a)(["\n  height: auto;\n\n  ",":last-child {\n    margin-bottom: 0;\n  }\n"]);return M=function(){return e},e}function V(){var e=Object(o.a)(["\n  margin-bottom: 1rem;\n"]);return V=function(){return e},e}function F(){var e=Object(o.a)(["\n  flex: 1;\n"]);return F=function(){return e},e}function q(){var e=Object(o.a)(["\n  margin-bottom: 1rem;\n\n  text-align: center;\n  font-weight: 900;\n  font-size: 2rem;\n"]);return q=function(){return e},e}function G(){var e=Object(o.a)(["\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n\n  border-right: 1px dotted ",";\n"]);return G=function(){return e},e}var H,K=s.b.div(G(),"#ccc"),Q=s.b.h1(q()),U=s.b.div(F()),W=Object(s.b)(g)(V()),X=s.b.div(M(),W),Y=s.b.p(B()),Z=s.b.div(T()),$=s.b.span(I()),_=s.b.div(z()),ee=s.b.span(J(),"#ccc"),ne=function(e){var n=e.player;return r.a.createElement(Z,null,r.a.createElement($,null,n.name),r.a.createElement(_,null,r.a.createElement(ee,null,n.initialLifePoints)))},te=function(){return r.a.createElement(Y,null,"Start by adding some players")},ae=function(e){var n=e.players,t=Object(u.e)();return r.a.createElement(K,null,r.a.createElement(Q,null,"magic"),r.a.createElement(U,null,n.length?r.a.createElement(U,null,n.map((function(e){return r.a.createElement(ne,{key:e.uuid,player:e})})),r.a.createElement(W,null,"Manage life points")):r.a.createElement(te,null)),r.a.createElement(X,null,r.a.createElement(W,{onClick:function(){t.push("/i/add-player")}},"Add player"),r.a.createElement(W,{onClick:function(){t.push("/i/add-device")}},"Add device")))},re=t(10),ce=t.n(re),le=t(19),ie=t(42),oe=function(){var e=Object(le.a)(ce.a.mark((function e(){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ie.a)("magic-db",1,{upgrade:function(e){e.createObjectStore("magic-store")}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=function(){var e=Object(le.a)(ce.a.mark((function e(){var n,t;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===H){e.next=2;break}return e.abrupt("return",H);case 2:return e.next=4,oe();case 4:if(n=e.sent,t=n.transaction("magic-store","readwrite"),null===window.localStorage.getItem("firstTabRegistered")){e.next=10;break}return H=!1,e.abrupt("return",!1);case 10:return window.localStorage.setItem("firstTabRegistered","true"),H=!0,window.addEventListener("beforeunload",(function(){window.localStorage.removeItem("firstTabRegistered")})),e.next=15,t.done;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=t(37),fe=t(26),de=t(36),be=t(20),me=t(38),pe=t(40),ve=t(11),he=t(41),ge=function(e){Object(pe.a)(t,e);var n=Object(me.a)(t);function t(){var e;Object(de.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=n.call.apply(n,[this].concat(r))).outgoingDataChannels=[],e.next=function(n){Object(he.a)(Object(ve.a)(t.prototype),"next",Object(be.a)(e)).call(Object(be.a)(e),n),e.outgoingDataChannels.map((function(e){return e.send(JSON.stringify(n))}))},e.addPlayer=function(n){var t=e.getValue();e.next(Object(fe.a)({},t,{players:[].concat(Object(se.a)(t.players),[n])}))},e.addOutgoingDataChannel=function(n){e.outgoingDataChannels.push(n),n.send(JSON.stringify(e.getValue()))},e}return t}(t(58).a),Oe=t(6),Ee=t(59),je=function(){var e=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun.services.mozilla.com:3478"]}]});return e.addEventListener("signalingstatechange",(function(e){console.info("onsignalingstatechange",e)})),e.addEventListener("iceconnectionstatechange",(function(e){console.info("oniceconnectionstatechange",e)})),e.addEventListener("icegatheringstatechange",(function(e){console.info("onicegatheringstatechange",e)})),e.addEventListener("datachannel",(function(e){console.info("ondatachannel",e);var n=e.channel;n.addEventListener("open",(function(e){return console.info("dataChannel.onopen",e)})),n.addEventListener("message",(function(e){return console.info("dataChannel.onmessage",e)})),n.addEventListener("error",(function(e){return console.info("dataChannel.onerror",e)}))})),e};function xe(){var e=Object(o.a)(["\n  display: block;\n  width: 100%;\n"]);return xe=function(){return e},e}var ye=s.b.div(xe()),we=function(e){var n=e.setAppObservable,t=Object(u.e)(),c=Object(a.useState)(null),l=Object(i.a)(c,2),o=l[0],s=l[1];return r.a.createElement(ye,null,r.a.createElement(C,{label:"Remote offer",onSubmit:null===o?function(e){s("Computing...");var a=function(e){var n=new RTCSessionDescription(e),t=je(),a=t.setRemoteDescription(n).then((function(){return t.createAnswer().then((function(e){return t.setLocalDescription(e)}))}));return[new Promise((function(e){t.addEventListener("icecandidate",(function(n){null==n.candidate&&a.then((function(){if(null===t.localDescription)throw new Error("`peerConnection.localDescription` is nullish.");e(t.localDescription)}))}))})),new Promise((function(e){t.addEventListener("datachannel",(function(n){var t=n.channel,a=new Oe.a((function(e){t.addEventListener("message",(function(n){e.next(JSON.parse(n.data))}))})).pipe(Object(Ee.a)(1));a.connect(),t.addEventListener("open",(function(){"app-state-channel"===t.label&&e(a)}))}))}))]}(e),r=Object(i.a)(a,2),c=r[0],l=r[1];c.then((function(e){s(JSON.stringify(e))})),l.then((function(e){n(e),t.push("/i")}))}:void 0,submitButtonLabel:"Confirm remote offer",placeholder:"Paste remote offer here",readOnly:null!==o}),null!==o?r.a.createElement(S,{label:"Answer",content:o}):null)};function Ce(){var e=Object(o.a)(["\n  max-width: 200px;\n  margin: 0 3rem;\n"]);return Ce=function(){return e},e}function Se(){var e=Object(o.a)(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  max-width: 640px;\n  height: 100vh;\n  margin: auto;\n"]);return Se=function(){return e},e}var ke=s.b.div(Se()),Le=Object(s.b)(g)(Ce()),De=function(e){var n=e.setAppObservable,t=Object(u.e)(),c=Object(a.useState)(null),l=Object(i.a)(c,2),o=l[0],s=l[1];return Object(a.useEffect)((function(){ue().then(s)}),[]),null===o?null:o?r.a.createElement(ke,null,r.a.createElement(u.d,null,r.a.createElement(u.c,{exact:!0,path:"/o"},r.a.createElement(Le,{onClick:function(){n(new ge({players:[]})),t.push("/i")}},"New master"),r.a.createElement(Le,{onClick:function(){t.push("/o/join")}},"Join remote master")),r.a.createElement(u.c,{path:"/o/join"},r.a.createElement(we,{setAppObservable:n})))):r.a.createElement(ke,null,r.a.createElement("i",null,"magic.mozaiqu.es already opened in an other tab."))},Ae=function(e){var n=e.addOutgoingDataChannel,t=Object(u.e)(),c=Object(a.useState)(null),l=Object(i.a)(c,2),o=l[0],s=l[1],f=Object(a.useState)(null),d=Object(i.a)(f,2),b=d[0],m=d[1];return Object(a.useEffect)((function(){var e=function(){var e=je(),n=e.createDataChannel("app-state-channel"),t=e.createOffer().then((function(n){e.setLocalDescription(n)}));return[new Promise((function(n){e.onicecandidate=function(a){null==a.candidate&&t.then((function(){if(null===e.localDescription)throw new Error("`peerConnection.localDescription` is nullish.");n(e.localDescription)}))}})),function(n){e.setRemoteDescription(n)},new Promise((function(e){n.addEventListener("open",(function(t){e(n)}))}))]}(),a=Object(i.a)(e,3),r=a[0],c=a[1],l=a[2];m((function(){return c})),r.then((function(e){s(JSON.stringify(e))})),l.then((function(e){n(e),t.push("/i")}))}),[n,t]),r.a.createElement(O,null,r.a.createElement(E,null,"Add device"),r.a.createElement(S,{label:"Offer",content:o||"Computing..."}),o&&b?r.a.createElement(C,{label:"Remote answer",onSubmit:function(e){b(new RTCSessionDescription(e))},submitButtonLabel:"Confirm remote answer",placeholder:"Paste remote answer here"}):null)};function Pe(){var e=Object(o.a)(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  font-style: italic;\n"]);return Pe=function(){return e},e}function Ne(){var e=Object(o.a)(["\n  body {\n    font-family: Lato, sans-serif;\n  }\n\n  * {\n    box-sizing: border-box;\n    padding: 0;\n    margin: 0;\n  }\n"]);return Ne=function(){return e},e}function Re(){var e=Object(o.a)(["\n  display: grid;\n  width: 100vw;\n  height: 100vh;\n  grid-template-columns: 280px auto;\n"]);return Re=function(){return e},e}var Je=s.b.div(Re()),ze=Object(s.a)(Ne()),Ie=s.b.div(Pe()),Te=function(e){var n=e.masterAppObservable;return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.c,{path:"/i/add-player"},r.a.createElement(R,{addPlayer:n.addPlayer})),r.a.createElement(u.c,{path:"/i/add-device"},r.a.createElement(Ae,{addOutgoingDataChannel:n.addOutgoingDataChannel})))},Be=function(e){var n=function(e){if(null===e)throw new Error("`useAppObservable` called with a nullish AppObservable.");var n=e instanceof ge?e.getValue():null,t=Object(a.useState)(n),r=Object(i.a)(t,2),c=r[0],l=r[1];return Object(a.useEffect)((function(){var n=e.subscribe((function(e){l(e)}));return function(){return n.unsubscribe()}}),[e]),[c,e instanceof ge?e:null]}(e.appObservable),t=Object(i.a)(n,2),c=t[0],l=t[1];return null===c?null:r.a.createElement(Je,null,r.a.createElement(ae,{players:c.players}),r.a.createElement(u.d,null,r.a.createElement(u.c,{exact:!0,path:"/i"},r.a.createElement(Ie,null,"No video stream yet")),l?r.a.createElement(Te,{masterAppObservable:l}):null))},Me=function(){var e=Object(a.useState)(null),n=Object(i.a)(e,2),t=n[0],c=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(ze,null),r.a.createElement(u.a,null,r.a.createElement(u.d,null,r.a.createElement(u.c,{path:"/o"},r.a.createElement(De,{setAppObservable:c})),r.a.createElement(u.c,{path:"/i"},r.a.createElement(Be,{appObservable:t})),r.a.createElement(u.b,{to:"/o"}))))};l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Me,null)),document.getElementById("root"))}},[[44,1,2]]]);
//# sourceMappingURL=main.86b142f5.chunk.js.map