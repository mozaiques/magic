{"version":3,"sources":["components.tsx","colors.tsx","subapps/add-player.tsx","Sidebar.tsx","db.tsx","observable.ts","webrtc.ts","subapps/join-remote-master.tsx","subapps/outside.tsx","subapps/add-device.tsx","App.tsx","index.tsx"],"names":["Button","styled","button","RightLayoutSection","div","RightLayoutH2","h2","Label","label","Input","input","Textarea","textarea","InputSubmitOfferAnswerRoot","InputSubmitOfferAnswer","placeholder","onSubmit","submitButtonLabel","readOnly","useState","rawOfferAnswer","setRawOfferAnswer","onChange","e","target","value","onClick","JSON","parse","FakeInputSubmitOfferAnswer","content","Buttons","LocalButton","InputText","type","InputNumber","console","log","AddPlayer","addPlayer","history","useHistory","name","setName","lifePoints","setLifePoints","newValue","toString","candidate","candidateLifePoints","parseInt","Number","isNaN","improvedSetLifePoint","push","uuid","replace","c","r","Math","random","initialLifePoints","isFirstTab","SidebarDiv","Magic","h1","Players","Actions","NoPlayerP","p","PlayerDiv","PlayerName","span","PlayerLifePointsDiv","PlayerLifePointsSpan","PlayerView","player","NoPlayer","Sidebar","players","length","map","key","getDB","a","openDB","upgrade","db","createObjectStore","tryRegisterFirstTab","undefined","tx","transaction","window","localStorage","getItem","setItem","addEventListener","removeItem","done","MasterAppObservable","outgoingDataChannels","next","dc","send","stringify","current","getValue","addOutgoingDataChannel","newOutgoingDataChannel","BehaviorSubject","makeRTCPeerConnection","peerConnection","RTCPeerConnection","iceServers","urls","evt","info","dataChannel","channel","err","JoinRemoteMasterRoot","JoinRemoteMaster","setAppObservable","answer","setAnswer","remoteOffer","remoteSessionDescription","RTCSessionDescription","locallySet","setRemoteDescription","then","createAnswer","desc","setLocalDescription","Promise","resolve","localDescription","Error","appStateChannelObservable","Observable","observer","data","pipe","publishReplay","connect","acceptRemoteOffer","localSessionDescriptionPromise","appStateObservablePromise","appStateObservable","OutsideDOMRoot","MagicAppOutside","setIsFirstTab","useEffect","exact","path","AddDevice","offer","setOffer","remoteDescriptionSetter","setRemoteDescriptionSetter","appStateChannel","createDataChannel","createOffer","onicecandidate","remoteDescription","createLocalOffer","localRemoteDescriptionSetter","appStateChannelPromise","sessionDescriptionInit","InsideDOMRoot","ResetCSS","createGlobalStyle","Home","ErrorNode","MasterRoutes","masterAppObservable","MagicAppInside","maybeAppObservable","initialValue","appState","setAppState","subscription","subscribe","as","unsubscribe","useAppObservable","appObservable","ErrorBoundary","props","state","hasError","errorString","this","children","error","React","Component","App","to","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e275aed8.chunk.js","sourcesContent":["import React, { useState } from \"react\";\nimport styled from \"styled-components\";\n\nimport { border, hover } from \"./colors\";\n\nexport const Button = styled.button`\n  display: block;\n  width: 100%;\n  padding: 1rem;\n\n  border: 1px dotted ${border};\n\n  font-size: 1rem;\n  background-color: white;\n  cursor: pointer;\n\n  &:hover {\n    background-color: ${hover};\n  }\n`;\n\nexport const RightLayoutSection = styled.div`\n  padding: 1rem;\n  max-width: 640px;\n`;\n\nexport const RightLayoutH2 = styled.h2`\n  margin-bottom: 1rem;\n\n  font-weight: 900;\n  font-size: 2rem;\n`;\n\nexport const Label = styled.label`\n  display: block;\n  margin-bottom: 2rem;\n`;\n\nexport const Input = styled.input`\n  display: block;\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  width: 100%;\n`;\n\nconst Textarea = styled.textarea`\n  display: block;\n  margin-top: 0.5rem;\n  padding: 0.5rem;\n  width: 100%;\n  height: 140px;\n\n  font-family: monospace;\n  word-break: break-all;\n  resize: none;\n`;\n\nconst InputSubmitOfferAnswerRoot = styled.div`\n  display: block;\n  width: 100%;\n`;\n\nexport const InputSubmitOfferAnswer = ({\n  label,\n  placeholder,\n  onSubmit,\n  submitButtonLabel,\n  readOnly,\n}: {\n  label: string;\n  placeholder?: string;\n  onSubmit?: (v: RTCSessionDescriptionInit) => void;\n  submitButtonLabel?: string;\n  readOnly?: boolean;\n}) => {\n  const [rawOfferAnswer, setRawOfferAnswer] = useState(\"\");\n  return (\n    <InputSubmitOfferAnswerRoot>\n      <Label>\n        {label}\n        <Textarea\n          placeholder={placeholder}\n          onChange={(e) => {\n            setRawOfferAnswer(e.target.value);\n          }}\n          value={rawOfferAnswer}\n          readOnly={readOnly}\n        />\n      </Label>\n      {onSubmit ? (\n        <Button\n          onClick={() => {\n            onSubmit(JSON.parse(rawOfferAnswer));\n          }}\n        >\n          {submitButtonLabel ? submitButtonLabel : \"Submit\"}\n        </Button>\n      ) : null}\n    </InputSubmitOfferAnswerRoot>\n  );\n};\n\nexport const FakeInputSubmitOfferAnswer = ({\n  label,\n  content,\n}: {\n  label: string;\n  content: string;\n}) => {\n  return (\n    <InputSubmitOfferAnswerRoot>\n      <Label>\n        {label}\n        <Textarea value={content} readOnly={true} />\n      </Label>\n    </InputSubmitOfferAnswerRoot>\n  );\n};\n","export const border = \"#ccc\";\nexport const hover = \"#f8f8f8\";\n","import React, { useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useHistory } from \"react-router-dom\";\n\nimport { Player } from \"../types\";\nimport { Button, RightLayoutSection, RightLayoutH2, Label, Input } from \"../components\";\n\nconst Buttons = styled.div`\n  display: flex;\n`;\n\nconst LocalButton = styled(Button)`\n  &:not(:last-child) {\n    margin-right: 1rem;\n  }\n`;\n\nconst uuidv4 = () => {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (Math.random() * 16) | 0,\n      v = c === \"x\" ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n};\n\nfunction InputText<T extends string>({\n  label,\n  placeholder,\n  value,\n  onChange,\n}: {\n  label: string;\n  placeholder: string;\n  value: T;\n  onChange: (t: T) => void;\n}) {\n  return (\n    <Label>\n      {label}\n      <Input\n        type=\"text\"\n        value={value}\n        placeholder={placeholder}\n        onChange={(e) => {\n          onChange(e.target.value as T);\n        }}\n      />\n    </Label>\n  );\n}\n\nfunction InputNumber<T extends string>({\n  label,\n  placeholder,\n  value,\n  onChange,\n}: {\n  label: string;\n  placeholder: string;\n  value: T;\n  onChange: (t: T) => void;\n}) {\n  return (\n    <Label>\n      {label}\n      <Input\n        type=\"text\"\n        value={value}\n        placeholder={placeholder}\n        onChange={(e) => {\n          console.log(e.target.value);\n          onChange(e.target.value as T);\n        }}\n      />\n    </Label>\n  );\n}\n\nexport const AddPlayer = ({ addPlayer }: { addPlayer: (newPlayer: Player) => void }) => {\n  const history = useHistory();\n  const [name, setName] = useState(\"\");\n  const [lifePoints, setLifePoints] = useState<number | null>(40);\n\n  const improvedSetLifePoint = (candidate: string) => {\n    const candidateLifePoints = parseInt(candidate);\n    if (Number.isNaN(candidateLifePoints) || candidateLifePoints <= 0) {\n      return setLifePoints(null);\n    }\n    return setLifePoints(candidateLifePoints);\n  };\n\n  return (\n    <RightLayoutSection>\n      <RightLayoutH2>Add player</RightLayoutH2>\n      <InputText\n        label=\"Player name\"\n        placeholder=\"Insert the player name\"\n        value={name}\n        onChange={(newValue) => {\n          setName(newValue);\n        }}\n      />\n      <InputNumber\n        label=\"Player initial life points\"\n        placeholder=\"Insert the player initial life points\"\n        value={lifePoints === null ? \"\" : lifePoints.toString()}\n        onChange={(newValue) => {\n          improvedSetLifePoint(newValue);\n        }}\n      />\n      <Buttons>\n        <LocalButton\n          onClick={() => {\n            history.push(\"/i\");\n          }}\n        >\n          Cancel\n        </LocalButton>\n        <LocalButton\n          onClick={() => {\n            if (name !== \"\" && lifePoints !== null) {\n              addPlayer({\n                uuid: uuidv4(),\n                name,\n                initialLifePoints: lifePoints,\n              });\n              history.push(\"/i\");\n            }\n          }}\n        >\n          Add player\n        </LocalButton>\n      </Buttons>\n    </RightLayoutSection>\n  );\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\n\nimport { border } from \"./colors\";\nimport { Player } from \"./types\";\nimport { useHistory } from \"react-router-dom\";\nimport { Button } from \"./components\";\n\nconst SidebarDiv = styled.div`\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n\n  border-right: 1px dotted ${border};\n`;\n\nconst Magic = styled.h1`\n  margin-bottom: 1rem;\n\n  text-align: center;\n  font-weight: 900;\n  font-size: 2rem;\n`;\n\nconst Players = styled.div`\n  flex: 1;\n`;\n\nconst LocalButton = styled(Button)`\n  margin-bottom: 1rem;\n`;\n\nconst Actions = styled.div`\n  height: auto;\n\n  ${LocalButton}:last-child {\n    margin-bottom: 0;\n  }\n`;\n\nconst NoPlayerP = styled.p`\n  font-style: italic;\n  text-align: center;\n`;\n\nconst PlayerDiv = styled.div`\n  display: flex;\n  padding: 1rem;\n`;\n\nconst PlayerName = styled.span`\n  flex: 1;\n`;\nconst PlayerLifePointsDiv = styled.div``;\nconst PlayerLifePointsSpan = styled.span`\n  padding: 0.25rem;\n  border-radius: 4px;\n  border: 1px solid ${border};\n`;\n\nconst PlayerView = ({ player }: { player: Player }) => (\n  <PlayerDiv>\n    <PlayerName>{player.name}</PlayerName>\n    <PlayerLifePointsDiv>\n      <PlayerLifePointsSpan>{player.initialLifePoints}</PlayerLifePointsSpan>\n    </PlayerLifePointsDiv>\n  </PlayerDiv>\n);\n\nconst NoPlayer = () => <NoPlayerP>Start by adding some players</NoPlayerP>;\n\nexport const Sidebar = ({ players }: { players: Player[] }) => {\n  const history = useHistory();\n  return (\n    <SidebarDiv>\n      <Magic>magic</Magic>\n      <Players>\n        {players.length ? (\n          <Players>\n            {players.map((p) => (\n              <PlayerView key={p.uuid} player={p} />\n            ))}\n            <LocalButton>Manage life points</LocalButton>\n          </Players>\n        ) : (\n          <NoPlayer />\n        )}\n      </Players>\n      <Actions>\n        <LocalButton\n          onClick={() => {\n            history.push(\"/i/add-player\");\n          }}\n        >\n          Add player\n        </LocalButton>\n        <LocalButton\n          onClick={() => {\n            history.push(\"/i/add-device\");\n          }}\n        >\n          Add device\n        </LocalButton>\n      </Actions>\n    </SidebarDiv>\n  );\n};\n","import { openDB } from \"idb\";\n\nconst DB_NAME = \"magic-db\";\nconst DB_VERSION = 1;\nconst STORE_NAME = \"magic-store\";\n\nconst FIRST_TAB_REGISTERED_KEY = \"firstTabRegistered\";\nlet isFirstTab: boolean | undefined;\n\nexport const getDB = async () =>\n  await openDB(DB_NAME, DB_VERSION, {\n    upgrade(db) {\n      db.createObjectStore(STORE_NAME);\n    },\n  });\n\nexport const tryRegisterFirstTab = async (): Promise<boolean> => {\n  if (isFirstTab !== undefined) {\n    return isFirstTab;\n  }\n\n  const db = await getDB();\n  const tx = db.transaction(STORE_NAME, \"readwrite\");\n\n  const isFirstTabAlreadyRegistered = window.localStorage.getItem(FIRST_TAB_REGISTERED_KEY);\n  if (isFirstTabAlreadyRegistered !== null) {\n    isFirstTab = false;\n    return false;\n  }\n\n  window.localStorage.setItem(FIRST_TAB_REGISTERED_KEY, \"true\");\n  isFirstTab = true;\n\n  window.addEventListener(\"beforeunload\", () => {\n    window.localStorage.removeItem(FIRST_TAB_REGISTERED_KEY);\n  });\n\n  await tx.done;\n  return true;\n};\n","import { useState, useEffect } from \"react\";\nimport { BehaviorSubject, Observable } from \"rxjs\";\n\nimport { AppState, Player } from \"./types\";\n\nexport type AppObservable = Observable<AppState>;\n\nexport class MasterAppObservable extends BehaviorSubject<AppState> {\n  outgoingDataChannels: RTCDataChannel[] = [];\n\n  next = (newValue: AppState) => {\n    super.next(newValue);\n    this.outgoingDataChannels.map((dc) => dc.send(JSON.stringify(newValue)));\n  };\n\n  addPlayer = (player: Player) => {\n    const current = this.getValue();\n    this.next({\n      ...current,\n      players: [...current.players, player],\n    });\n  };\n\n  addOutgoingDataChannel = (newOutgoingDataChannel: RTCDataChannel) => {\n    this.outgoingDataChannels.push(newOutgoingDataChannel);\n    newOutgoingDataChannel.send(JSON.stringify(this.getValue()));\n  };\n}\n\nexport const initNewMasterObservable = () => new MasterAppObservable({ players: [] });\n\nexport const useAppObservable = (\n  maybeAppObservable: AppObservable | null\n): [AppState | null, MasterAppObservable | null] => {\n  if (maybeAppObservable === null) {\n    throw new Error(\"`useAppObservable` called with a nullish AppObservable.\");\n  }\n\n  const initialValue =\n    maybeAppObservable instanceof MasterAppObservable ? maybeAppObservable.getValue() : null;\n\n  const [appState, setAppState] = useState<AppState | null>(initialValue);\n\n  useEffect(() => {\n    const subscription = maybeAppObservable.subscribe((as) => {\n      setAppState(as);\n    });\n    return () => subscription.unsubscribe();\n  }, [maybeAppObservable]);\n\n  return [appState, maybeAppObservable instanceof MasterAppObservable ? maybeAppObservable : null];\n};\n","import { Observer, Observable, ConnectableObservable } from \"rxjs\";\nimport { publishReplay } from \"rxjs/operators\";\nimport { AppState } from \"./types\";\nimport { AppObservable } from \"./observable\";\n\nconst APP_STATE_CHANNEL_LABEL = \"app-state-channel\";\n\nconst makeRTCPeerConnection = () => {\n  const peerConnection = new RTCPeerConnection({\n    iceServers: [{ urls: [\"stun:stun.l.google.com:19302\"] }],\n  });\n\n  peerConnection.addEventListener(\"signalingstatechange\", (evt) => {\n    console.info(\"onsignalingstatechange\", evt);\n  });\n  peerConnection.addEventListener(\"iceconnectionstatechange\", (evt) => {\n    console.info(\"oniceconnectionstatechange\", evt);\n  });\n  peerConnection.addEventListener(\"icegatheringstatechange\", (evt) => {\n    console.info(\"onicegatheringstatechange\", evt);\n  });\n\n  peerConnection.addEventListener(\"datachannel\", (evt) => {\n    console.info(\"ondatachannel\", evt);\n    const dataChannel = evt.channel;\n    dataChannel.addEventListener(\"open\", (evt) => console.info(\"dataChannel.onopen\", evt));\n    dataChannel.addEventListener(\"message\", (evt) => console.info(\"dataChannel.onmessage\", evt));\n    dataChannel.addEventListener(\"error\", (err) => console.info(\"dataChannel.onerror\", err));\n  });\n\n  return peerConnection;\n};\n\nexport const createLocalOffer = (): [\n  Promise<RTCSessionDescription>,\n  (remoteDescription: RTCSessionDescription) => void,\n  Promise<RTCDataChannel>\n] => {\n  const peerConnection = makeRTCPeerConnection();\n  const appStateChannel = peerConnection.createDataChannel(APP_STATE_CHANNEL_LABEL);\n\n  const locallySet = peerConnection.createOffer().then((desc) => {\n    peerConnection.setLocalDescription(desc);\n  });\n\n  const localSessionDescriptionPromise: Promise<RTCSessionDescription> = new Promise((resolve) => {\n    peerConnection.onicecandidate = (candidate) => {\n      if (candidate.candidate == null) {\n        locallySet.then(() => {\n          if (peerConnection.localDescription === null) {\n            throw new Error(\"`peerConnection.localDescription` is nullish.\");\n          }\n          resolve(peerConnection.localDescription);\n        });\n      }\n    };\n  });\n\n  const remoteDescriptionSetter = (remoteDescription: RTCSessionDescription) => {\n    peerConnection.setRemoteDescription(remoteDescription);\n  };\n\n  const appStateChannelPromise: Promise<RTCDataChannel> = new Promise((resolve) => {\n    appStateChannel.addEventListener(\"open\", (evt) => {\n      resolve(appStateChannel);\n    });\n  });\n\n  return [localSessionDescriptionPromise, remoteDescriptionSetter, appStateChannelPromise];\n};\n\nexport const acceptRemoteOffer = (\n  remoteOffer: RTCSessionDescriptionInit\n): [Promise<RTCSessionDescription>, Promise<AppObservable>] => {\n  const remoteSessionDescription = new RTCSessionDescription(remoteOffer);\n  const peerConnection = makeRTCPeerConnection();\n\n  const locallySet = peerConnection\n    .setRemoteDescription(remoteSessionDescription)\n    .then(() =>\n      peerConnection.createAnswer().then((desc) => peerConnection.setLocalDescription(desc))\n    );\n\n  const localSessionDescriptionPromise: Promise<RTCSessionDescription> = new Promise((resolve) => {\n    peerConnection.addEventListener(\"icecandidate\", (candidate) => {\n      if (candidate.candidate == null) {\n        locallySet.then(() => {\n          if (peerConnection.localDescription === null) {\n            throw new Error(\"`peerConnection.localDescription` is nullish.\");\n          }\n          resolve(peerConnection.localDescription);\n        });\n      }\n    });\n  });\n\n  const appStateObservablePromise: Promise<AppObservable> = new Promise((resolve) => {\n    peerConnection.addEventListener(\"datachannel\", (evt) => {\n      const dataChannel = evt.channel;\n\n      const appStateChannelObservable: Observable<AppState> = new Observable(\n        (observer: Observer<AppState>) => {\n          dataChannel.addEventListener(\"message\", (evt) => {\n            observer.next(JSON.parse(evt.data));\n          });\n        }\n      ).pipe(publishReplay(1));\n      (appStateChannelObservable as ConnectableObservable<AppState>).connect();\n\n      dataChannel.addEventListener(\"open\", () => {\n        if (dataChannel.label === APP_STATE_CHANNEL_LABEL) {\n          resolve(appStateChannelObservable);\n        }\n      });\n    });\n  });\n\n  return [localSessionDescriptionPromise, appStateObservablePromise];\n};\n","import React, { useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useHistory } from \"react-router-dom\";\n\nimport { AppObservable } from \"../observable\";\nimport { InputSubmitOfferAnswer, FakeInputSubmitOfferAnswer } from \"../components\";\nimport { acceptRemoteOffer } from \"../webrtc\";\n\nconst JoinRemoteMasterRoot = styled.div`\n  display: block;\n  width: 100%;\n`;\n\nexport const JoinRemoteMaster = ({\n  setAppObservable,\n}: {\n  setAppObservable: (ao: AppObservable) => void;\n}) => {\n  const history = useHistory();\n  const [answer, setAnswer] = useState<string | null>(null);\n\n  return (\n    <JoinRemoteMasterRoot>\n      <InputSubmitOfferAnswer\n        label={\"Remote offer\"}\n        onSubmit={\n          answer === null\n            ? (remoteOffer) => {\n                setAnswer(\"Computing...\");\n\n                const [\n                  localSessionDescriptionPromise,\n                  appStateObservablePromise,\n                ] = acceptRemoteOffer(remoteOffer);\n\n                localSessionDescriptionPromise.then((desc) => {\n                  setAnswer(JSON.stringify(desc));\n                });\n\n                appStateObservablePromise.then((appStateObservable) => {\n                  setAppObservable(appStateObservable);\n                  history.push(\"/i\");\n                });\n              }\n            : undefined\n        }\n        submitButtonLabel={\"Confirm remote offer\"}\n        placeholder={\"Paste remote offer here\"}\n        readOnly={answer !== null}\n      />\n      {answer !== null ? <FakeInputSubmitOfferAnswer label={\"Answer\"} content={answer} /> : null}\n    </JoinRemoteMasterRoot>\n  );\n};\n","import React, { useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\n\nimport { Button } from \"../components\";\nimport { tryRegisterFirstTab } from \"../db\";\nimport { AppObservable, initNewMasterObservable } from \"../observable\";\n\nimport { JoinRemoteMaster } from \"./join-remote-master\";\n\nconst OutsideDOMRoot = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  max-width: 640px;\n  height: 100vh;\n  margin: auto;\n`;\n\nconst LocalButton = styled(Button)`\n  max-width: 200px;\n  margin: 0 3rem;\n`;\n\nexport const MagicAppOutside = ({\n  setAppObservable,\n}: {\n  setAppObservable: (ao: AppObservable) => void;\n}) => {\n  const history = useHistory();\n  const [isFirstTab, setIsFirstTab] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    tryRegisterFirstTab().then(setIsFirstTab);\n  }, []);\n\n  if (isFirstTab === null) {\n    return null;\n  }\n\n  if (!isFirstTab) {\n    return (\n      <OutsideDOMRoot>\n        <i>magic.mozaiqu.es already opened in an other tab.</i>\n      </OutsideDOMRoot>\n    );\n  }\n\n  return (\n    <OutsideDOMRoot>\n      <Switch>\n        <Route exact path=\"/o\">\n          <LocalButton\n            onClick={() => {\n              setAppObservable(initNewMasterObservable());\n              history.push(\"/i\");\n            }}\n          >\n            New master\n          </LocalButton>\n          <LocalButton\n            onClick={() => {\n              history.push(\"/o/join\");\n            }}\n          >\n            Join remote master\n          </LocalButton>\n        </Route>\n        <Route path=\"/o/join\">\n          <JoinRemoteMaster setAppObservable={setAppObservable} />\n        </Route>\n      </Switch>\n    </OutsideDOMRoot>\n  );\n};\n","import React, { useState, useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\n\nimport {\n  RightLayoutSection,\n  RightLayoutH2,\n  FakeInputSubmitOfferAnswer,\n  InputSubmitOfferAnswer,\n} from \"../components\";\nimport { createLocalOffer } from \"../webrtc\";\n\ntype RemoteDescriptionSetterTyper = ((remoteDescription: RTCSessionDescription) => void) | null;\n\nexport const AddDevice = ({\n  addOutgoingDataChannel,\n}: {\n  addOutgoingDataChannel: (dc: RTCDataChannel) => void;\n}) => {\n  const history = useHistory();\n  const [offer, setOffer] = useState<string | null>(null);\n  const [remoteDescriptionSetter, setRemoteDescriptionSetter] = useState<\n    RemoteDescriptionSetterTyper\n  >(null);\n\n  useEffect(() => {\n    const [\n      localSessionDescriptionPromise,\n      localRemoteDescriptionSetter,\n      appStateChannelPromise,\n    ] = createLocalOffer();\n\n    setRemoteDescriptionSetter(() => localRemoteDescriptionSetter);\n\n    localSessionDescriptionPromise.then((desc) => {\n      setOffer(JSON.stringify(desc));\n    });\n\n    appStateChannelPromise.then((dc) => {\n      addOutgoingDataChannel(dc);\n      history.push(\"/i\");\n    });\n  }, [addOutgoingDataChannel, history]);\n\n  return (\n    <RightLayoutSection>\n      <RightLayoutH2>Add device</RightLayoutH2>\n      <FakeInputSubmitOfferAnswer label={\"Offer\"} content={offer || \"Computing...\"} />\n\n      {offer && remoteDescriptionSetter ? (\n        <InputSubmitOfferAnswer\n          label={\"Remote answer\"}\n          onSubmit={(sessionDescriptionInit) => {\n            remoteDescriptionSetter(new RTCSessionDescription(sessionDescriptionInit));\n          }}\n          submitButtonLabel={\"Confirm remote answer\"}\n          placeholder={\"Paste remote answer here\"}\n        />\n      ) : null}\n    </RightLayoutSection>\n  );\n};\n","import React, { useState } from \"react\";\nimport { MemoryRouter, Switch, Route, Redirect } from \"react-router-dom\";\nimport styled, { createGlobalStyle } from \"styled-components\";\n\nimport { AddPlayer } from \"./subapps/add-player\";\n\nimport { Sidebar } from \"./Sidebar\";\nimport { MagicAppOutside } from \"./subapps/outside\";\nimport { AppObservable, useAppObservable, MasterAppObservable } from \"./observable\";\nimport { AddDevice } from \"./subapps/add-device\";\n\nconst InsideDOMRoot = styled.div`\n  display: grid;\n  width: 100vw;\n  height: 100vh;\n  grid-template-columns: 280px auto;\n`;\n\nconst ResetCSS = createGlobalStyle`\n  body {\n    font-family: Lato, sans-serif;\n  }\n\n  * {\n    box-sizing: border-box;\n    padding: 0;\n    margin: 0;\n  }\n`;\n\nconst Home = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  font-style: italic;\n`;\n\nconst ErrorNode = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100vw;\n  height: 100vh;\n\n  font-style: italic;\n`;\n\nconst MasterRoutes = ({ masterAppObservable }: { masterAppObservable: MasterAppObservable }) => (\n  <>\n    <Route path=\"/i/add-player\">\n      <AddPlayer addPlayer={masterAppObservable.addPlayer} />\n    </Route>\n    <Route path=\"/i/add-device\">\n      <AddDevice addOutgoingDataChannel={masterAppObservable.addOutgoingDataChannel} />\n    </Route>\n  </>\n);\n\nconst MagicAppInside = ({ appObservable }: { appObservable: AppObservable | null }) => {\n  const [appState, masterAppObservable] = useAppObservable(appObservable);\n\n  if (appState === null) {\n    return null;\n  }\n\n  return (\n    <InsideDOMRoot>\n      <Sidebar players={appState.players} />\n      <Switch>\n        <Route exact path=\"/i\">\n          <Home>No video stream yet</Home>\n        </Route>\n        {masterAppObservable ? <MasterRoutes masterAppObservable={masterAppObservable} /> : null}\n      </Switch>\n    </InsideDOMRoot>\n  );\n};\n\nclass ErrorBoundary extends React.Component<{}, { hasError: boolean; errorString: null | string }> {\n  constructor(props: any) {\n    super(props);\n    this.state = { hasError: false, errorString: null };\n  }\n\n  static getDerivedStateFromError(error: any) {\n    return { hasError: true, errorString: error.toString() };\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return <ErrorNode>{`Oopsie, something went wrong: ${this.state.errorString}.`}</ErrorNode>;\n    }\n\n    return this.props.children;\n  }\n}\n\nexport const App = () => {\n  const [appObservable, setAppObservable] = useState<AppObservable | null>(null);\n\n  return (\n    <>\n      <ResetCSS />\n      <ErrorBoundary>\n        <MemoryRouter>\n          <Switch>\n            <Route path=\"/o\">\n              <MagicAppOutside setAppObservable={setAppObservable} />\n            </Route>\n            <Route path=\"/i\">\n              <MagicAppInside appObservable={appObservable} />\n            </Route>\n            <Redirect to=\"/o\" />\n          </Switch>\n        </MemoryRouter>\n      </ErrorBoundary>\n    </>\n  );\n};\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport { App } from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}